{"ast":null,"code":"import _objectSpread from \"/Users/anmolu/GitHub/testing-site/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"/Users/anmolu/GitHub/testing-site/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/anmolu/GitHub/testing-site/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { whichButtons, getOffsetPosition } from './event-utils';\nvar DEFAULT_OPTIONS = {\n  srcElement: 'root',\n  priority: 0\n};\n\nvar EventRegistrar = /*#__PURE__*/function () {\n  function EventRegistrar(eventManager) {\n    var _this = this;\n\n    _classCallCheck(this, EventRegistrar);\n\n    /**\n     * Handles hammerjs event\n     */\n    this.handleEvent = function (event) {\n      if (_this.isEmpty()) {\n        return;\n      }\n\n      var mjolnirEvent = _this._normalizeEvent(event);\n\n      var target = event.srcEvent.target;\n\n      while (target && target !== mjolnirEvent.rootElement) {\n        _this._emit(mjolnirEvent, target);\n\n        if (mjolnirEvent.handled) {\n          return;\n        }\n\n        target = target.parentNode;\n      }\n\n      _this._emit(mjolnirEvent, 'root');\n    };\n\n    this.eventManager = eventManager;\n    this.handlers = []; // Element -> handler map\n\n    this.handlersByElement = new Map();\n    this._active = false;\n  } // Returns true if there are no non-passive handlers\n\n\n  _createClass(EventRegistrar, [{\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return !this._active;\n    }\n  }, {\n    key: \"add\",\n    value: function add(type, handler, options) {\n      var once = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var passive = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      var handlers = this.handlers,\n          handlersByElement = this.handlersByElement;\n      var opts = DEFAULT_OPTIONS;\n\n      if (typeof options === 'string' || options && options.addEventListener) {\n        // is DOM element, backward compatibility\n        // @ts-ignore\n        opts = _objectSpread(_objectSpread({}, DEFAULT_OPTIONS), {}, {\n          srcElement: options\n        });\n      } else if (options) {\n        opts = _objectSpread(_objectSpread({}, DEFAULT_OPTIONS), options);\n      }\n\n      var entries = handlersByElement.get(opts.srcElement);\n\n      if (!entries) {\n        entries = [];\n        handlersByElement.set(opts.srcElement, entries);\n      }\n\n      var entry = {\n        type: type,\n        handler: handler,\n        srcElement: opts.srcElement,\n        priority: opts.priority\n      };\n\n      if (once) {\n        entry.once = true;\n      }\n\n      if (passive) {\n        entry.passive = true;\n      }\n\n      handlers.push(entry);\n      this._active = this._active || !entry.passive; // Sort handlers by descending priority\n      // Handlers with the same priority are excuted in the order of registration\n\n      var insertPosition = entries.length - 1;\n\n      while (insertPosition >= 0) {\n        if (entries[insertPosition].priority >= entry.priority) {\n          break;\n        }\n\n        insertPosition--;\n      }\n\n      entries.splice(insertPosition + 1, 0, entry);\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(type, handler) {\n      var handlers = this.handlers,\n          handlersByElement = this.handlersByElement;\n\n      for (var i = handlers.length - 1; i >= 0; i--) {\n        var entry = handlers[i];\n\n        if (entry.type === type && entry.handler === handler) {\n          handlers.splice(i, 1);\n          var entries = handlersByElement.get(entry.srcElement);\n          entries.splice(entries.indexOf(entry), 1);\n\n          if (entries.length === 0) {\n            handlersByElement.delete(entry.srcElement);\n          }\n        }\n      }\n\n      this._active = handlers.some(function (entry) {\n        return !entry.passive;\n      });\n    }\n    /**\n     * Invoke handlers on a particular element\n     */\n\n  }, {\n    key: \"_emit\",\n    value: function _emit(event, srcElement) {\n      var entries = this.handlersByElement.get(srcElement);\n\n      if (entries) {\n        var immediatePropagationStopped = false; // Prevents the current event from bubbling up\n\n        var stopPropagation = function stopPropagation() {\n          event.handled = true;\n        }; // Prevent any remaining listeners from being called\n\n\n        var stopImmediatePropagation = function stopImmediatePropagation() {\n          event.handled = true;\n          immediatePropagationStopped = true;\n        };\n\n        var entriesToRemove = [];\n\n        for (var i = 0; i < entries.length; i++) {\n          var _entries$i = entries[i],\n              type = _entries$i.type,\n              handler = _entries$i.handler,\n              once = _entries$i.once;\n          handler(_objectSpread(_objectSpread({}, event), {}, {\n            // @ts-ignore\n            type: type,\n            stopPropagation: stopPropagation,\n            stopImmediatePropagation: stopImmediatePropagation\n          }));\n\n          if (once) {\n            entriesToRemove.push(entries[i]);\n          }\n\n          if (immediatePropagationStopped) {\n            break;\n          }\n        }\n\n        for (var _i = 0; _i < entriesToRemove.length; _i++) {\n          var _entriesToRemove$_i = entriesToRemove[_i],\n              _type = _entriesToRemove$_i.type,\n              _handler = _entriesToRemove$_i.handler;\n          this.remove(_type, _handler);\n        }\n      }\n    }\n    /**\n     * Normalizes hammerjs and custom events to have predictable fields.\n     */\n\n  }, {\n    key: \"_normalizeEvent\",\n    value: function _normalizeEvent(event) {\n      var rootElement = this.eventManager.getElement();\n      return _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, event), whichButtons(event)), getOffsetPosition(event, rootElement)), {}, {\n        preventDefault: function preventDefault() {\n          event.srcEvent.preventDefault();\n        },\n        stopImmediatePropagation: null,\n        stopPropagation: null,\n        handled: false,\n        rootElement: rootElement\n      });\n    }\n  }]);\n\n  return EventRegistrar;\n}();\n\nexport { EventRegistrar as default };","map":{"version":3,"mappings":"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","names":["whichButtons","getOffsetPosition","DEFAULT_OPTIONS","srcElement","priority","EventRegistrar","eventManager","event","isEmpty","mjolnirEvent","_normalizeEvent","target","srcEvent","rootElement","_emit","handled","parentNode","handlers","handlersByElement","Map","_active","type","handler","options","once","passive","opts","addEventListener","entries","get","set","entry","push","insertPosition","length","splice","i","indexOf","delete","some","immediatePropagationStopped","stopPropagation","stopImmediatePropagation","entriesToRemove","remove","getElement","preventDefault"],"sourceRoot":"","sources":["../../../src/utils/event-registrar.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}